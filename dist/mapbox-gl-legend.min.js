"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),className="mapboxgl-ctrl mapboxgl-legend",defaultOptions={order:"qgis",overlaysOrder:[],basemapsOrder:[]},MapboxLegend=function(){function e(t,a,r){_classCallCheck(this,e),this._overlays=t,this._basemaps=a,this._options=void 0==r?defaultOptions:r,this._overlaysOrder=void 0==this._options.overlaysOrder||0==this._options.overlaysOrder.length?Object.keys(t).map(function(e){return t[e].id}):this._options.overlaysOrder,this._basemapsOrder=void 0==this._options.basemapsOrder||0==this._options.basemapsOrder.length?Object.keys(a):this._options.basemapsOrder,this._sources=Object.keys(t).map(function(e){return t[e].source}),this._container=document.createElement("div"),this._container.className=""+className,this._addCSS()}return _createClass(e,[{key:"onAdd",value:function(e){return this._map=e,this._updateLegend(),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container)}},{key:"changeOrder",value:function(e){this._overlaysOrder=e,this._updateOverlays()}},{key:"_updateLegend",value:function(){this._container.innerHTML="",this._updateBasemaps(),this._updateOverlays(),this._checkChosenBasemap()}},{key:"_updateBasemaps",value:function(){var e=document.createElement("ul");e.id="mapbox-gl-legend-basemaps";var t=!0,a=!1,r=void 0;try{for(var i,n=this._basemapsOrder[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;e.appendChild(this._createBasemap(s,this._basemaps[s]))}}catch(o){a=!0,r=o}finally{try{!t&&n["return"]&&n["return"]()}finally{if(a)throw r}}this._container.appendChild(e),this._container.appendChild(document.createElement("hr"))}},{key:"_updateOverlays",value:function(){if(null!=document.getElementById("mapbox-gl-legend-overlays")){var e=document.getElementById("mapbox-gl-legend-overlays");e.parentNode.removeChild(e)}var t=document.createElement("ul");t.id="mapbox-gl-legend-overlays";var a=!0,r=!1,i=void 0;try{for(var n,s=this._overlaysOrder[Symbol.iterator]();!(a=(n=s.next()).done);a=!0){var o=n.value;for(var l in this._overlays)this._overlays[l].id==o&&t.appendChild(this._createOverlay(l,this._overlays[l]))}}catch(d){r=!0,i=d}finally{try{!a&&s["return"]&&s["return"]()}finally{if(r)throw i}}if("qgis"==this._options.order){var c=!0,u=!1,p=void 0;try{for(var y,h=this._overlaysOrder.slice().reverse()[Symbol.iterator]();!(c=(y=h.next()).done);c=!0){var v=y.value;this._map.moveLayer(v)}}catch(d){u=!0,p=d}finally{try{!c&&h["return"]&&h["return"]()}finally{if(u)throw p}}}else{var m=!0,_=!1,b=void 0;try{for(var f,g=this._overlaysOrder[Symbol.iterator]();!(m=(f=g.next()).done);m=!0){var O=f.value;this._map.moveLayer(O)}}catch(d){_=!0,b=d}finally{try{!m&&g["return"]&&g["return"]()}finally{if(_)throw b}}}this._container.appendChild(t)}},{key:"_createOverlay",value:function(e,t){var a=document.createElement("li"),r=document.createElement("input");r.setAttribute("type","checkbox"),r.setAttribute("layer",t.id),r.id=t.id.replace(/^[^a-z]+|[^\w:.-]+/gi,"")+"-layer";var i=document.createElement("a");i.style["float"]="right",i.setAttribute("layer",t.id),i.id=t.id.replace(/^[^a-z]+|[^\w:.-]+/gi,"")+"-layer",i.appendChild(document.createTextNode("↑"));var n=document.createElement("a");n.style["float"]="right",n.setAttribute("layer",t.id),n.id=t.id.replace(/^[^a-z]+|[^\w:.-]+/gi,"")+"-layer",n.appendChild(document.createTextNode("↓")),a.appendChild(r),a.appendChild(document.createTextNode(""+e)),a.appendChild(n),a.appendChild(i),r.addEventListener("change",this._toggleLayer.bind(this)),i.addEventListener("click",this._upLayer.bind(this)),n.addEventListener("click",this._downLayer.bind(this));var s=this._map.getLayoutProperty(t.id,"visibility");return("visible"==s||void 0==s)&&(this._map.setLayoutProperty(t.id,"visibility","visible"),r.checked=!0),a}},{key:"_createBasemap",value:function(e){var t=document.createElement("li"),a=document.createElement("input");return a.setAttribute("type","radio"),a.setAttribute("name","basemaps"),a.setAttribute("basemap",e),a.id=e.replace(/^[^a-z]+|[^\w:.-]+/gi,"")+"-basemap",t.appendChild(a),t.appendChild(document.createTextNode(""+e)),a.addEventListener("change",this._selectBasemap.bind(this)),t}},{key:"_upLayer",value:function(e){var t=e.target.getAttribute("layer"),a=this._overlaysOrder.indexOf(t);0!=a&&(this._overlaysOrder.splice(a-1,0,this._overlaysOrder.splice(a,1)[0]),this._updateOverlays())}},{key:"_downLayer",value:function(e){var t=e.target.getAttribute("layer"),a=this._overlaysOrder.indexOf(t);a!=this._overlaysOrder.length-1&&(this._overlaysOrder.splice(a+1,0,this._overlaysOrder.splice(a,1)[0]),this._updateOverlays())}},{key:"_selectBasemap",value:function(e){var t=this,a=this._map.getStyle().sources;this._map.setStyle(this._basemaps[e.target.getAttribute("basemap")]),setTimeout(function(){for(var e in a)t._sources.indexOf(e)>-1&&t._map.addSource(e,a[e]);for(var r in t._overlays)t._map.addLayer(t._overlays[r]);t._updateOverlays()},1e3)}},{key:"_checkChosenBasemap",value:function(){var e=this,t=function(t){fetch(e._basemaps[t]).then(function(e){return e.json()}).then(function(a){e._map.getStyle().name==a.name&&(document.getElementById(t.replace(/^[^a-z]+|[^\w:.-]+/gi,"")+"-basemap").checked=!0)})};for(var a in this._basemaps)t(a)}},{key:"_toggleLayer",value:function(e){e.target.checked?this._showLayer(e.target.getAttribute("layer")):this._hideLayer(e.target.getAttribute("layer"))}},{key:"_showLayer",value:function(e){this._map.setLayoutProperty(e,"visibility","visible")}},{key:"_hideLayer",value:function(e){this._map.setLayoutProperty(e,"visibility","none")}},{key:"_addCSS",value:function(){var e=document.createElement("style"),t=void 0;t=this._overlaysOrder.length>0?"in-line":"none",e.type="text/css",e.innerHTML="\n        .mapboxgl-legend {\n            margin: 25px;\n            padding: 5px;\n            background: red;\n            position: relative;\n            display: "+t+"\n        }\n        .mapboxgl-legend ul {\n            list-style: none;\n            padding: 0;\n        }",document.body.appendChild(e)}}]),e}();